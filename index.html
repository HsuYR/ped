<html>
    <head>
        <title>兒科劑量小幫手</title>
        <style>
            :root {
                --primary-color: #4a90e2;
                --secondary-color: #6ac0ff;
                --accent-color: #ff6b6b;
                --text-color: #333;
                --light-bg: #f5f8fa;
                --border-color: #ddd;
            }

            body {
                font-family: 'Noto Sans TC', Arial, Helvetica, sans-serif;
                font-size: 16pt;
                line-height: 1.6;
                color: var(--text-color);
                background-color: var(--light-bg);
                margin: 0;
                padding: 20px;
            }

            h2 {
                color: var(--primary-color);
                border-bottom: 2px solid var(--primary-color);
                padding-bottom: 10px;
                margin-top: 30px;
                font-size: 24pt;
            }

            input[type="text"], 
            input[type="number"],
            textarea,
            select {
                border: 1px solid var(--border-color);
                padding: 8px 12px;
                border-radius: 6px;
                font-size: 16pt;
                transition: border-color 0.3s;
            }

            input[type="text"]:focus,
            input[type="number"]:focus,
            textarea:focus,
            select:focus {
                border-color: var(--primary-color);
                outline: none;
                box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
            }

            textarea {
                width: 100%;
                min-height: 100px;
                resize: vertical;
            }

            input[type="radio"],
            input[type="checkbox"] {
                width: 20px;
                height: 20px;
                margin-right: 5px;
                vertical-align: middle;
            }

            label {
                margin-right: 15px;
                display: inline-flex;
                align-items: center;
                cursor: pointer;
            }

            button {
                background-color: var(--primary-color);
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 6px;
                font-size: 16pt;
                cursor: pointer;
                transition: background-color 0.3s;
            }

            button:hover {
                background-color: var(--secondary-color);
            }

            p {
                margin: 15px 0;
            }

            #present-illness-text {
                background-color: white;
                border: 1px solid var(--border-color);
                border-radius: 6px;
                padding: 15px;
                margin-top: 20px;
            }

            /* 藥物計算區塊樣式 */
            div:has(#weight) {
                background-color: white;
                border-radius: 6px;
                padding: 15px;
                margin-top: 20px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }

            #dose {
                font-size: 20pt;
                color: var(--accent-color);
                font-weight: bold;
                display: block;
                margin-top: 15px;
            }

            #description {
                background-color: #f0f7ff;
                border-left: 4px solid var(--primary-color);
                padding: 10px 15px;
                margin-top: 15px;
                white-space: pre-wrap;
                font-size: 14pt;
            }

            /* 選項組樣式 */
            optgroup {
                font-weight: bold;
                color: var(--primary-color);
            }

            /* 響應式設計 */
            @media (max-width: 768px) {
                body {
                    font-size: 14pt;
                    padding: 10px;
                }
                
                h2 {
                    font-size: 20pt;
                }
                
                button {
                    font-size: 14pt;
                    padding: 8px 16px;
                }
                
                input[type="text"], 
                input[type="number"],
                textarea,
                select {
                    font-size: 14pt;
                }
                
                #dose {
                    font-size: 18pt;
                }
            }

            /* 症狀和體徵選擇區塊 */
            p:has([name="cc"]),
            p:has([name="sx"]),
            #signs,
            #auscultSides,
            #auscults,
            #labs,
            #urines,
            #cxrSides,
            #cxrs,
            #impressions {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                background-color: white;
                padding: 10px;
                border-radius: 6px;
                border: 1px solid var(--border-color);
            }

            /* 添加一些間距和分隔 */
            form {
                max-width: 1200px;
                margin: 0 auto;
            }
        </style>
    </head>
    <body>
        <form id="present-illness" name="present-illness">
            
            <h2>Present Illness</h2>
            <p>This is a 
                <input type="text" id="age" size="2">-year-old 
                <input type="radio" id="sex-boy" name="sex" value="boy" checked><label for="sex-boy">boy</label>
                <input type="radio" id="sex-girl" name="sex" value="girl"><label for="sex-girl">girl</label>
                with <input type="text" name="underly" value="no known underlying disease">. 
                The patient was vaccinated as scheduled and had achieved developmental milestone. 
                According to the patient's family, 
            </p>
            <p>
                <input type="radio" id="cc-headache" name="cc" value="headache"><label for="cc-headache">headache</label>
                <input type="radio" id="cc-dizziness" name="cc" value="dizziness"><label for="cc-dizziness">dizziness</label>
                <input type="radio" id="cc-fever" name="cc" value="fever"><label for="cc-fever">fever</label>
                <input type="radio" id="cc-sorethroat" name="cc" value="sorethroat"><label for="cc-sorethroat">sorethroat</label>
                <input type="radio" id="cc-horseness" name="cc" value="horseness"><label for="cc-horseness">horseness</label>
                <input type="radio" id="cc-rhinorrhea" name="cc" value="rhinorrhea"><label for="cc-rhinorrhea">rhinorrhea</label>
                <input type="radio" id="cc-nasal-discharge" name="cc" value="nasal discharge"><label for="cc-nasal-discharge">nasal discharge</label>
                <input type="radio" id="cc-nasal-congestion" name="cc" value="nasal congestion"><label for="cc-nasal-congestion">nasal congestion</label>
                <input type="radio" id="cc-productive-cough" name="cc" value="productive cough"><label for="cc-productive-cough">productive cough</label>
                <input type="radio" id="cc-shortness-of-breath" name="cc" value="shortness of breath"><label for="cc-shortness-of-breath">shortness of breath</label>
                <input type="radio" id="cc-chest-tightness" name="cc" value="chest tightness"><label for="cc-chest-tightness">chest tightness</label>
                <input type="radio" id="cc-abdoninal-pain" name="cc" value="abdoninal pain"><label for="cc-abdoninal-pain">abdoninal pain</label>
                <input type="radio" id="cc-diarrhea" name="cc" value="diarrhea"><label for="cc-diarrhea">diarrhea</label>
                <input type="radio" id="cc-dysuria" name="cc" value="dysuria"><label for="cc-dysuria">dysuria</label>
                <input type="radio" id="cc-urinary-frequency" name="cc" value="urinary frequency"><label for="cc-urinary-frequency">urinary frequency</label>
                <input type="radio" id="cc-poor-appetite" name="cc" value="poor appetite"><label for="cc-poor-appetite">poor appetite</label>
                <input type="radio" id="cc-poor-activity" name="cc" value="poor activity"><label for="cc-poor-activity">poor activity</label>
            </p>
            <p>
                for <input type="text" id="duration" value="3 days"> 
                accompanied with 
            </p>
            <p>
                <input type="checkbox" id="sx-headache" name="sx" value="headache"><label for="sx-headache">headache</label>
                <input type="checkbox" id="sx-dizziness" name="sx" value="dizziness"><label for="sx-dizziness">dizziness</label>
                <input type="checkbox" id="sx-fever" name="sx" value="fever"><label for="sx-fever">fever</label>
                <input type="checkbox" id="sx-sorethroat" name="sx" value="sorethroat"><label for="sx-sorethroat">sorethroat</label>
                <input type="checkbox" id="sx-horseness" name="sx" value="horseness"><label for="sx-horseness">horseness</label>
                <input type="checkbox" id="sx-rhinorrhea" name="sx" value="rhinorrhea"><label for="sx-rhinorrhea">rhinorrhea</label>
                <input type="checkbox" id="sx-nasal-discharge" name="sx" value="nasal discharge"><label for="sx-nasal-discharge">nasal discharge</label>
                <input type="checkbox" id="sx-nasal-congestion" name="sx" value="nasal congestion"><label for="sx-nasal-congestion">nasal congestion</label>
                <input type="checkbox" id="sx-productive-cough" name="sx" value="productive cough"><label for="sx-productive-cough">productive cough</label>
                <input type="checkbox" id="sx-shortness-of-breath" name="sx" value="shortness of breath"><label for="sx-shortness-of-breath">shortness of breath</label>
                <input type="checkbox" id="sx-chest-tightness" name="sx" value="chest tightness"><label for="sx-chest-tightness">chest tightness</label>
                <input type="checkbox" id="sx-abdoninal-pain" name="sx" value="abdoninal pain"><label for="sx-abdoninal-pain">abdoninal pain</label>
                <input type="checkbox" id="sx-diarrhea" name="sx" value="diarrhea"><label for="sx-diarrhea">diarrhea</label>
                <input type="checkbox" id="sx-dysuria" name="sx" value="dysuria"><label for="sx-dysuria">dysuria</label>
                <input type="checkbox" id="sx-urinary-frequency" name="sx" value="urinary frequency"><label for="sx-urinary-frequency">urinary frequency</label>
                <input type="checkbox" id="sx-poor-appetite" name="sx" value="poor appetite"><label for="sx-poor-appetite">poor appetite</label>
                <input type="checkbox" id="sx-poor-activity" name="sx" value="poor activity"><label for="sx-poor-activity">poor activity</label>
            </p>
            <p>
                was noted. The patient had <input type="text" id="cluster-history" value="cluster history with">.
            </p>
            <p>
                <input type="text" id="progression" value="" style="width: 100%">
            </p>
            <p>
                <textarea type="text" id="lmd-visit" style="width: 100%">The patient was taken to LMD where medication were given, but the condition deteriorated.</textarea>
            </p>
            <p>
                Therefore, the patient was brought to our 
                <input type="radio" id="visit-er" name="visit" value="emergency department" checked><label for="visit-er">emergency department</label>
                <input type="radio" id="visit-opd" name="visit" value="outpatient department"><label for="visit-opd">outpatient department</label>
                for help.
            </p>

            <p>
                Upon arrival, physical examination showed
            </p>
            <p id="signs"></p>
            <p id="auscultSides"></p>
            <p id="auscults"></p>
            <p id="labs"></p>
            <p id="urines"></p>
            <p id="cxrSides"></p>
            <p id="cxrs"></p>
            <p><input type="checkbox" id="steeple" value="Neck X-ray showed steeple sign"><label for="steeple">Steeple Sign</label></p>
            <p>Under the impression of</p>
            <p id="impressions"></p>

        </form>
        <div><button onclick="writePi()">Write!</button></div>
        <p id="present-illness-text"></p>

        <div>
            <label for="weight">體重：</label><input type="number" name="weight" id="weight" value=20> kg
            <select id="drug">
                <option value="">Choose a drug</option>
                <optgroup label="止痛退燒">
                    <option value="antiphen">Anti-phen syr. (Acetaminophen)</option>
                    <option value="depyretin">Depyretin tab (Acetaminophen)</option>
                    <option value="ibuprofen">Idofen susp. (Ibuprofen)</option>
                    <option value="diclofenac">Votalin supp. (Diclofenac)</option>
                </optgroup>
                <optgroup label="抗組織胺、鼻塞">
                    <option value="cypromin">Cypromin syr. (Cyproheptadine)</option>
                    <option value="pilian">Pilian tab (Cyproheptadine)</option>
                    <option value="cetirizine">Cetirizine soln</option>
                    <option value="xyzal">Xyzal tab (Levocetirizine)</option>
                    <option value="peacesyr">Peace syr. (Triprolidine/Pseudoephedrine)</option>
                    <option value="peacetab">Peace tab. (Triprolidine/Pseudoephedrine)</option>
                </optgroup>
                <optgroup label="咳嗽、喘">
                    <option value="casteine">Casteine syr. (S-Carboxymethylcysteine)</option>
                    <option value="colin">Colin syr. (Chlorpheniramine/Platycodon/Glycyrrhizine)</option>
                    <option value="meptin">Meptin liq. (Procaterol)</option>
                    <option value="meptintab">Meptin-mini tab (Procaterol)</option>
                    <option value="xanthium">Xanthium (Theophylline)</option>
                    <option value="aminophyllin">Aminophyllin inj.</option>
                </optgroup>
                <optgroup label="嘔吐拉肚子">
                    <option value="cod">Cod</option>
                    <option value="haddock">Haddock</option>
                    <option value="salmon">Salmon</option>
                    <option value="turbot">Turbot</option>
                </optgroup>
                <optgroup label="抗微生物">
                    <option value="cod">Cod</option>
                    <option value="haddock">Haddock</option>
                    <option value="salmon">Salmon</option>
                    <option value="turbot">Turbot</option>
                </optgroup>
                <optgroup label="其他">
                    <option value="cod">Cod</option>
                    <option value="haddock">Haddock</option>
                    <option value="salmon">Salmon</option>
                    <option value="turbot">Turbot</option>
                </optgroup>
            </select>
            <button action="" onclick="updateDose()">計算</button>
        </div>
        <div>
            <result id="dose"></result>
        </div>
        <br>
        <br>
        <div>
            <text id="description"></text>
        </div>
    </body>
    <script>
        function initPiForm() {
            function createInputElement(type, id, name, value, appendDOM) {
                let inputDOM = document.createElement("input")
                inputDOM.type=type
                inputDOM.id=`${name}-${value.replace(" ", "-")}`
                inputDOM.name=`${name}`
                inputDOM.value=value

                let labelDOM = document.createElement("label")
                labelDOM.htmlFor=`${name}-${value.replace(" ", "-")}`
                labelDOM.innerText=value
                appendDOM.appendChild(inputDOM)
                appendDOM.appendChild(labelDOM)
                return
            }

            let piForm = document.querySelector("#present-illness")
            let sex = ["boy", "girl"]
            let symptoms = [
                "headache",
                "dizziness",
                "sorethroat",
                "horseness",
                "rhinorrhea",
                "nasal discharge",
                "nasal congestion",
                "productive cough",
                "shortness of breath",
                "chest tightness",
                "abdominal pain",
                "diarrhea",
                "dysuria",
                "urinary frequency",
                "poor appetite",
                "poor activity",
            ]
            let signs = [
                "injected throat",
                "injected tonsil",
                "injected eardrum",
            ]
            signs.forEach(sign => createInputElement("checkbox", "sign", "sign", sign, document.querySelector("#signs")))

            let auscultSides = [
                "bilateral",
                "right",
                "left",
            ]
            auscultSides.forEach(auscultSide => createInputElement("checkbox", "auscultSide", "auscultSide", auscultSide, document.querySelector("#auscultSides")))
            let auscults = [
                "rales",
                "wheezing",
                "stridor",
                "ronchi",
            ]
            auscults.forEach(auscult => createInputElement("checkbox", "auscult", "auscult", auscult, document.querySelector("#auscults")))
            
            let labs = [
                "leukocytosis",
                "neutropenia",
                "microcytic anemia",
                "elevated CRP",
                "elevated liver enzyme",
                "anti-mycoplasma IgM positive",
                "Influenza Ag positive",
                "Covid-19 positive",
            ]
            labs.forEach(lab => createInputElement("checkbox", "lab", "lab", lab, document.querySelector("#labs")))

            let urines = [
                "pyuria",
                "hematuria",
                "bacteruria",
            ]
            urines.forEach(urine => createInputElement("checkbox", "urine", "urine", urine, document.querySelector("#urines")))

            let cxrSides = [
                "bilateral",
                "RUL",
                "RLL",
                "LUL",
                "LLL",
            ]
            cxrSides.forEach(cxrSide => createInputElement("checkbox", "cxrSide", "cxrSide", cxrSide, document.querySelector("#cxrSides")))

            let cxrs = [
                "infiltration",
                "pneumonia patch",
            ]
            cxrs.forEach(cxr => createInputElement("checkbox", "cxr", "cxr", cxr, document.querySelector("#cxrs")))

            let impressions = [
                "pneumonia due to mycoplasma infection",
                "fever due to influenza A infection",
                "covid-19 disease",
                "viral croup with covid-19 disease",
                "pyuria, suspect urinary tract infection",
                "bronchitis",
                "tonsillitis",
                "pharyngitis",
                "otitis media",
                "acute gastroenteritis",
                "acute hepatitis",
            ]
            impressions.forEach(impression => createInputElement("checkbox", "impression", "impression", impression, document.querySelector("#impressions")))

        }

        function writePi() {
            
            document.getElementById("present-illness-text").innerText = 
            `This is a ${document.querySelector("#age")?.value}-year-old ${document.querySelector("[name=sex]:checked")?.value} with ${document.querySelector("[name=underly]")?.value}. \
            The patient was vaccinated as scheduled and had achieved developmental milestone. \
            According to the patient's family, \
            ${document.querySelector("[name=cc]:checked")?.value} for ${document.querySelector("#duration")?.value} accompanied with ${[...document.querySelectorAll(`[name=sx]:checked:not([value='${document.querySelector("[name=cc]:checked")?.value}'])`)]?.map(e => e.value).join(", ")} was noted. \
            The patient denied ${[...document.querySelectorAll(`[name=sx]:not(:checked):not([value='${document.querySelector("[name=cc]:checked")?.value}'])`)].map(e => e.value).join(", ")}. \
            The patient had ${document.querySelector("#cluster-history")?.value}. \
            ${document.querySelector("#progression")?.value} \
            ${document.querySelector("#lmd-visit")?.value} \
            Therefore, the patient was brought to our ${document.querySelector("[name=visit]:checked")?.value} for help.

            Upon arrival, physical examination showed ${[...document.querySelectorAll(`[name=sign]:checked`)]?.map(e => e.value).join(", ")}. \
            ${document.querySelector("[name=auscultSide]:checked")?.value} ${[...document.querySelectorAll(`[name=auscult]:checked`)]?.map(e => e.value).join(", ")} was noted. \
            Laboratory data showed ${[...document.querySelectorAll(`[name=lab]:checked`)]?.map(e => e.value).join(", ")}. \
            ${document.querySelectorAll(`[name=urine]:checked`)?.length>0 ? "Urine analysis showed" : ""} \
            ${[...document.querySelectorAll(`[name=urine]:checked`)]?.map(e => e.value).join(", ")}${document.querySelectorAll(`[name=urine]:checked`)?.length>0 ? "." : ""} \
            Chest X-ray showed ${document.querySelector("[name=cxrSide]:checked")?.value} ${[...document.querySelectorAll(`[name=cxr]:checked`)]?.map(e => e.value).join(", ")}. \
            ${document.querySelectorAll(`[name=steeple]:checked`).length>0 ? "Neck X-ray showed steeple sign." : ""}
            Under the impression of ${[...document.querySelectorAll(`[name=impression]:checked`)]?.map(e => e.value).join(", ")}, \
            the patient was admitted to our ward for further evaluation and treatment.`
        }


        function round(n, d=0) {
            return n.toFixed(d)
        }

        let drugList = {
            antiphen: "Syr.: 24mg/ml, 60ml/btl\n\
            Neonates: 10~15mg/kg/dose every q6h~8h\n\
            Infants & Children: 10~15mg/kg/dose every q4h~6h\n\
            Children≧12yr & Adults: Max. 4gm/day",
            depyretin: "Tab.: 500mg/tab\n\
            Neonates: 10~15mg/kg/dose every q6h~8h\n\
            Infants & Children: 10~15mg/kg/dose every q4h~6h\n\
            Children≧12yr & Adults: Max. 4gm/day",
            ibuprofen: "Susp.:20mg/ml, 60ml/btl\n\
            Infants & Children: 5~10mg/kg/dose every q6h~8h, Max.: 40mg/kg/day",
            diclofenac: "Supp.: 12.5mg/supp\n\
            Rectal: 1~2mg/kg/dose",

            cypromin: "Syr.: 0.4mg/ml, 60ml/btl\n\
            Children ≥2 years and Adolescents: 0.25mg/kg/day, bid~tid\n\
            2~6yr: 2mg q12h~q8h, Max.: 12mg/day\n\
            7~14yr: 4mg q12h~q8h, Max.: 16mg/day",
            pilian: "Tab.: 4mg/tab\n\
            Children ≥2 years and Adolescents: 0.25mg/kg/day, bid~tid\n\
            2~6yr: 2mg q12h~q8h, Max.: 12mg/day\n\
            7~14yr: 4mg q12h~q8h, Max.: 16mg/day",
            cetirizine: "Soln: 1mg/ml, 30ml/btl\n\
            6~12M: 2.5ml qd\n\
            1~2 yr:2.5ml qd~bid\n\
            2~5 yr:2.5~5ml/day qd~bid\n\
            ≧6 yr:5~10ml/day qd~bid",
            xyzal: `Tab.: 5 mg/tab
            6yr~Adults: 5mg QD
            *陳曉能醫師會用小劑量 TID`,
            peacesyr: `Syr.: 1ml = Triprolidine 0.25mg / Pseudoephedrine 6mg
            Dosing based on pseudoephedrine: 4mg/kg/day tid~qid`,
            peacetab: `Tab.: 2.5 mg/60 mg/tab
            Dosing based on pseudoephedrine: 4mg/kg/day tid~qid`,
            
            casteine: `Syr.: 50mg/ml, 60ml/btl
            <5yr: 5 ~10 ml/day divided in tid
            5~12yr: 5ml tid
            Adults: maintenance 7.5 ml qid`,
            colin: `Syr.: 1ml = Chlorpheniramine 0.4mg / Platycodon 0.012ml / Polygala 0.012ml / Glycyrrhizine 0.5mg
            6~12yr:2.5ml tid~qid`,
            meptin: `Liq.: 5mcg/ml
            Pediatric dose: 2.5mcg/kg/day in 2-3 divided dose`,
            meptintab: `Tab.: 25mcg/tab
            Pediatric dose: 2.5mcg/kg/day in 2-3 divided dose`,
            xanthium: `Cap.: 200mg/cap
            1# / 20kg, BID or Q12H`,
            aminophyllin: `250mg/10ml/amp
            * risk of arrhythmia, irritation, tachypnea
            3mg/kg/dose Q6H, drip 30min`,
            
        }

        function updateDose() {
            let weight = document.getElementById("weight").value
            let drug = document.getElementById("drug").value
            document.getElementById("dose").innerText = calculateDose(weight, drug)
            document.getElementById("description").innerText = drugList[drug]
        }

        function calculateDose(weight, drug) {
            /* 
            / 止痛退燒
            */
            if (drug == "antiphen") {
                // 24mg/ml
                // 10~15mg/kg/dose every q4h~6h
                return `${round(weight/2, 1)}ml Q4H~Q6H (Infant & Children)`
            }
            if (drug == "depyretin") {
                // 500mg/tab
                // 10~15mg/kg/dose every q4h~6h
                return `${10*weight/500}~${15*weight/500} tab Q4H~Q6H`
            }
            if (drug == "ibuprofen") {
                // 20mg/ml
                // 5~10mg/kg/dose every q6h~8h, Max.: 40mg/kg/day
                return `${5*weight/20}~${10*weight/20}ml Q4H~Q6H (Infant & Children)`
            }
            if (drug == "diclofenac") {
                // Supp.: 12.5mg/supp
                // Rectal: 1~2mg/kg/dose
                return `${round(1*weight/12.5)}~${round(2*weight/12.5)} supp. Q6H`
            }
            /*
            / 抗組織胺、鼻塞
            */
            if (drug == "cypromin") {
                // Syr.: 0.4mg/ml, 60ml/btl 
                // 0.25mg/kg/day, bid~tid 
                return `${round(0.625*weight/3, 1)}ml TID (≥2yr)`
            }
            if (drug == "pilian") {
                // Tab.: 4mg/tab
                // 2~6yr: 2mg q12h~q8h, Max.: 12mg/day
                // 7~14yr: 4mg q12h~q8h, Max.: 16mg/day
                return `2-6yr 0.5 tab TID, 7-14yr 1 tab TID`
            }
            if (drug == "cetirizine") {
                return `6~12M: 2.5ml qd, 1~5 yr:2.5ml bid, ≧6 yr:5ml bid`
            }
            if (drug == "xyzal") {
                return `1 tab QD (≧6yr)`
            }
            if (drug == "peacesyr") {
                return `${round(4*weight/6/3, 1)}ml TID`
            }
            if (drug == "peacetab") {
                return `${round(4*weight/60, 1)} tab TID`
            }
            /*
            / 咳嗽
            */
            if (drug == "casteine") {
                return `<5yr: 3.3ml TID, 5~12yr: 5ml TID, >12yr: 7.5 ml QID`
            }
            if (drug == "colin") {
                return `${round(weight/3, 1)}ml TID`
            }
            if (drug == "meptin") {
                return `${round(weight/4, 1)}ml BID`
            }
            if (drug == "meptintab") {
                return `${round(weight/20, 1)} tab BID`
            }
            if (drug == "xanthium") {
                return `${round(weight/20, 1)} tab BID or Q12H`
            }
            if (drug == "aminophyllin") {
                return `${(3*weight/250)}`
            }
            if (drug == "bricanyl") {

            }
        }
        window.addEventListener("load", initPiForm);
    </script>
</html>